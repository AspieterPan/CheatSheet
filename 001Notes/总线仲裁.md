---
Aliases: 
tags: 计算机/组成原理 
DateCreated: 2023-08-10T20:59
DateModified: 2023-08-10T21:25
---
# 总线仲裁

Top:: [[王道 - 计算机组成原理]] - 第六章 - 总线 - 6.2

## 总线仲裁的基本概念
---
- 同一时刻只能有一个设备控制总线传输操作,可以有一个或多个设备从总线接收数据。
- 将总线上所连接的各类设备按其对总线有无控制功能分为:
	- 主设备: 获得总线控制权的设备。
	- 从设备: 被主设备访问的设备,只能响应从主设备发来的各和种总线命令。
- 为什么要仲裁?
	- 总线作为一种共享设备,不可避免地会出现同一时刻有多个主设备竞争总线控制权的问题。

## 集中仲裁方式
---
- 工作流程
	1. 主设备发出请求信号;
	2. 若多个主设备同时要使用总线,则由总线控制器的判优、仲裁逻辑按一定的优先等级顺序确定哪个主设备能使用总线;
	3. 获得总线使用权的主设备开始传送数据。
- 链式查询方式
	- " 总线忙 " 信号的建立者是 获得总线控制权的设备
	- 优先级:
		- 离总线控制器越近的部件, 其优先级越高;
		- 离总线控制器越远的部件, 其优先级越低。
	- 优点:
		- 链式查询方式优先级固定。
		- 只需很少几根控制线就能按一定优先次序实现总线控制,结构简单,扩充容易。
	- 缺点:
		- 对硬件电路的故障敏感并且优先级不能改变。
		- 当优先级高的部件频繁请求使用总线时,会使优先级较低的部件长期不能使用总线。
- 计数器查询方式
	- 结构特点
		- 用一个计数器控制总线使用权,相对链式查询方式多了一组设备地址线,少了一根总线响应线 BG; 它仍共用一根总线请求线。
	- 当总线控制器收到总线请求信号,判断总线空闲时,计数器开始计数,计数值通过设备地址线发向各个部件。
	- 当地址线上的计数值与请求使用总线设备的地址一致时,该设备获得总线控制权。同时,中止计数器的计数及查询。
	- 优点:
		1. 计数初始值可以改变优先次序
			- 计数每次从 "0" 开始,设备的优先级就按 顺序排列,固定不变;
			- 计数从上一次的终点开始,此时设备使用总线的优先级相等;
			- 计数器的初值还可以由程序设置
		2. 对电路的故障没有链式敏感
	- 缺点:
		1. 增加了控制线数
			- 若设备有 n 个,则需 $\log_{2}n$+2 条控制线
		2. 控制相对比链式查询相对复杂
- 独立请求方式
	- 结构特点:
		- 每一个设备均有一对总线请求线 $BG_{i}$ 和总线允许线 $BG_{i}$。
	- 当总线控制器按一定的优先次序决定批准某个部件的请求时,则给该部件发送总线响应信号。
	- 当总线上的部件需要使用总线时,经各自的总线请求线发送总线请求信号,在总线控制器中排队。
	- 优点:
		1. 响应速度快,总线允许信号 BG 直接从控制器发送到有关设备, 不必在设备间传递或者查询。
		2. 对优先次序的控制相当灵活。
	- 缺点:
		1. 控制线数量多
			- 若设备有 n 则需要 2n-1 条控制线。
				- 其中 +1 为 BS 线,用于设备向总线控制部件反馈已经是否正在使用总线。
		2. 总线的控制逻辑更加复杂

## 分布仲裁方式
---
- 特点:
	- 不需要中央仲裁器,每个潜在的主模块都有自己的仲裁器和和仲裁号,多个仲裁器竞争使用总线。
- 当设备有总线请求时,它们就把各自唯一的仲裁号发送到共享的仲裁总线上;
- 每个仲裁器将从仲裁总线上得到的仲裁号与自己的仲裁号进行比较;
- 如果仲裁总线上的号优先级高,则它的总线请求不予响应,并撤销它的仲裁号;
- 最后,获胜者的仲裁号保留在仲裁总线上。
