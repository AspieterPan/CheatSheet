---
Aliases: 
tags: 计算机/组成原理 
DateCreated: 2023-08-05T17:22
DateModified: 2023-08-08T14:02
---
# 指令周期的数据流

Top:: [[王道 - 计算机组成原理]] - 第五章 - 中央处理器 - 5.2

## 指令周期
---
- CPU 从主存中每取出并执行一条指令所需的全部时间。
- 指令周期常常用若干**机器周期**来表示,机器周期又叫 **CPU 周期**。
- 一个**机器周期**又包含若干**时钟周期**
	- (也称为节拍、T 周期或 CPU 时钟周期,
	- 它是 CPU 操作的 **最基本单位**)
- 每个指令周期内机器周期数可以不等，每个机器周期内的节拍数也可以不等
	- 空指令 NOP
		- 取指周期
	- 加法指令 ADD
		- 取指周期
		- 执行周期
	- 乘法指令 MUL
		- 取指周期
		- 执行周期（包含的时钟周期比 ADD 多）
	- 具有间接寻址的指令
		- 取指周期
		- 间址周期
		- 执行周期
	- 具有中断的指令
		- 取指周期
		- 间址周期
		- 执行周期
		- 中断周期
1. 取指周期
	1. 取指令
	2. 对指令译码（很快）
2. 执行周期

## 指令周期流程
---

 ```mermaid
flowchart TD
A1[取指周期] --> P1{"有间址吗"}
P1 --是-->A2[间址周期]
A2 --> A3[执行周期]
P1 --否-->A3
A3 --> P2{有中断吗}
P2 --是--> A4[中断周期]
P2 --否--> A1
A4 --> A1
```

## 指令周期的数据流
---
### 取指周期

1. 当前指令地址送至存储器地址寄存器,
	- 记做:(PC) -> MAR
2. CU 发出控制信号,经控制总线传到主存,这里是读信号,
	- 记做: 1 -> R
3. 将 MAR 所指主存中的内容经数据总线 送入 MDR,
	- 记做: M(MAR) -> MDR
4. 4.将 MDR 中的内容 (此时是指令) 送入 IR,
	- 记做: (MDR) -> IR
5. CU 发出控制信号,形成下一条指令地址,
	- 记做:(PC)+1 -> PC
### 间址周期

1. 将指令的地址码送入 MAR,
	- 记做 Ad(IR) -> MAR
		- 或 Ad(MDR) -> MAR
2. CU 发出控制信号,启动主存做读操作
	- 记做:1→R
3. 将 MAR 所指主存中的内容经数据总线 送入 MDR,
	- 记做: M(MAR) -> MDR  

### 执行周期

执行周期的任务是根据 IR 中的指令字的操作码和操作数通过过 ALU 操作产生执行结果。
不同指令的执行周期操作不同,因此没有统一的数据流向

### 中断周期

- 中断
	- 暂停当前任务去完成其他任务。
	- 为了能够恢复当前任务,需要保存断点。
	- 一般使用堆栈来保存断点,这里用 SP 表示栈顶地址,假设 SP 指向栈顶元素,进栈操作是先修改指针,后存入数据。
	1. CU 控制将 SP 减 1,修改后的地址送入 MAR
		1. 记作：(SP)-1 -> SP, (SP) -> MAR
			1. 注：王道这里没有讲清楚，这里是先将当前 PC 的值压入栈，然后将栈中 PC 所在的地址放入 MAR
		2. 本质上是将断点存入某个存储单元,假设 地址为 a,故可记做: a -> MAR
	2. 2.CU 发出控制信号,启动主存做写操作,
		1. 记做:1 -> W
	3. 3.将断点 (PC 内容) 送入 MDR,
		1. 记做 (PC)→ MDR
	4. CU 控制将中断服务程序的入口地址送入 PC，
		1. 记做 向量地址 -> PC

> [!question] 为什么是先发出写信号，然后才将 PC 的数值输送到 MDR?
> 我的理解是，在开启读/写信号的时候，MDR 就会根据 MAR 的地址对主存进行读/写，所以应该是先把 PC 的值放入 MDR，然后再开启写信号
> 在进行主存读取的时候，因为是先读数据到 MDR，然后再将 MDR 的数据送出去，所以是控制信号先行


## 指令执行方案
---
1. 方案 1.单指令周期
	- 对所有指令都选用相同的执行时间来完成。
	- 指令之间串行执行;
	- 指令周期取决于执行时间最长的指令的执行时间。
	- 对于那些本来可以在更短时间内完成的指令,
	- 要使用这个较长的周期来完成,
	- 会降低整个系统的运行速度。
2. 方案 2.多指令周期
	- 对不同类型的指令选用不同的执行步骤来完成。
	- 指令之间串行执行;
	- 可选用不同个数的时钟周期
	- 来完成不同指令的执行过程。
	- 需要更复杂的硬件设计。
3. 方案 3.流水线方案
	- 在每一个时钟周期启动一条指令,
	- 尽量让多条指令同时运行,
	- 但各自处在不同的执行步骤中。
	- 指令之间并行执行。
