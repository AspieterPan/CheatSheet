---
Aliases: 
tags: Computer/Compose 
DateCreated: 2023-08-14T05:28
DateModified: 2023-08-14T09:47
---
# DMA 方式

Top :: [[Computer Compose]] - 第七章 - 输入输出系统 - 7.3.5

## DMA 控制器
---

> DMA 控制器通常用来一些 " 块设备 "（例如磁盘）

- CPU 向 DMA 控制器指明
	- 要输入还是输出;
	- 要传送多少个数据;
	- 数据在主存、外设中的地址。
- DMA 工作流程
	- 传送前
		- 接受外设发出的 DMA 请求 (外设传送一个字的请求),并向 CPU 发出总线请求。
		- CPU 响应此总线请求,发出总线响应信号,接管总线控制权,进入 DMA 操作周期。
	- 传送时
		- 确定传送数据的主存单元地址及长度, 并能自动修改主存地址计数和传送长度计数。
		- 规定数据在主存和外设间的传送方向,发出读写等控制信号,执行数据传送操作。
	- 向 CPU 报告 DMA 操作的结束。

![[DMA 方式_1.png]]

- 控制/状态逻辑
	- 由控制和时序电路及状态标志组成,用于指定传送方向,修改传送参数,并对 DMA 请求信号和 CPU 响应信号进行协调和同步。
- DMA 请求触发器
	- 每当 I/0 设备准备好数据后给出一个控制信号,使 DMA 请求触发器置位。
- 主存地址计数器
	- 简称 AR,存放要交换数据的主存地址。
- 传送长度计数器
	- 简称 WC,用来记录传送数据的长度,计数溢出时,数据即传送完毕,自动发中断请求信号。
- 数据缓冲寄存器
	- 用于暂存每次传送的数据
- 中断机构
	- 当一个数据块传送完毕后触发中断机构,向 CPU 提出中断请求。

> 注: 在 DMA 传送过程中,DMA 控制器将接管 CPU 的地址总线、数据总线和控制总线,CPU 的主存控制信号被禁止使用。而当 DMA 传送结束后,将恢复 CPU 的一切权利并开始执行其操作。

## DMA 方式的特点
---
- 主存和 DMA 接口之间有一条直接数据通路。
- 由于 DMA 方式传送数据不需要经过 CPU,因此不必中断现行程序/0 与主机并行工作,程序和传送并行工作。
- DMA 方式具有下列特点:
	1. 它使主存与 CPU 的固定联系脱钩,主存既可被 CPU 访问,又可被外设访问。
	2. 在数据块传送时,主存地址的确定、传送数据的 计数等都由硬件电路直接实现。
	3. 主存中要开辟专用缓冲区,及时供给和接收外设 的数据。
	4. DMA 传送速度快,CPU 和外设并行工作,提高了 系统效率。
	5. DMA 在传送开始前要通过程序进行预处理,结束 后要通过中断方式进行后处理。

## DMA 传送方式
---
- 主存和 DMA 控制器之间有一条数据通路,
	- 因此主存和 l/0 设备之间交换信息时,不通过 CPU。
	- 但当 l/O 设备和 CPU 同时访问主存时,可能发生冲突,
- 为了有效地使用主存,DMA 控制器与 CPU 通常采用以下 3 种方法使用主存。
	1. 停止 CPU 访问主存
		- 优点
			- 控制简单
		- 缺点
			- CPU 处于不工作状态或保持状态
			- 未充分发挥 CPU 对主存的利用率
	2. DMA 与 CPU 交替访存
		- 一个 CPU 周期，分为 C1 和 C2 两个周期
			- C1 专供 DMA 访存
			- C2 专供 CPU 访存
		- 优点
			- 不需要总线使用权的申请、建立和归还过程
		- 缺点
			- 硬件逻辑更为复杂
	3. 周期挪用（周期窃取）
		- DMA 访问主存有三种可能
			- CPU 此时不访存（不冲突）
			- CPU 正在访存（存取周期结束让出总线）
			- CPU 与 DMA 同时请求访存（I/O 访存优先）

|  | 中断 | DMA |
| :---: | :---: | :---: |
| 数据传送 | $\begin{array}{c}\text { 程序控制 } \\\text { 程序的切换 } \rightarrow \text { 保存和恢复现场 }\end{array}$ | $\begin{array}{c}\text { 硬件控制 } \\\text { CPU只需进行预处理和后处理 }\end{array}$ |
| 中断请求 | 传送数据 | 后处理 |
| 响应 | 指令执行周期结束后响应中断 | $\begin{array}{c}\text { 每个机器周期结束均可, 总线空 } \\\text { 闲时即可响应DMA请求 }\end{array}$ |
| 场景 | CPU控制, 低速设备 | DMA控制器控制, 高速设备 |
| 优先级 | 优先级低于DMA | 优先级高于中断 |
| 异常处理 | 能处理异常事件 | 仅传送数据 |